#!/usr/bin/env bash
set -euo pipefail

echo "[pre-commit] Checking for forbidden title tooltips …"

# staged HTML/JS/TS files (Added/Modified/Renamed/Copied)
mapfile -d '' FILES < <(
  git diff --cached --name-only --diff-filter=ACMR -z \
  | grep -zE '\.(html?|js|ts)$'
)

# nothing to check?
((${#FILES[@]}==0)) && { echo "[pre-commit] OK (no relevant files staged)"; exit 0; }

# if node exists -> use node checker on staged files
if command -v node >/dev/null 2>&1; then
  # pass file list to the script
  node scripts/check-no-title.js "${FILES[@]}"
else
  echo "[pre-commit] Node not found – skipping check (CI/Maven will catch it)."
fi

echo "[pre-commit] OK"
