#!/usr/bin/env sh
# pre-commit: nur noch der Menü-Toggle-Event-Check

set -u
echo "[pre-commit] Checking menu toggle events …"

changed="$(git diff --cached --name-only --diff-filter=ACMRTUXB \
  | tr -d '\r' \
  | grep -Ei '\.(html|js|ts)$' || true)"

[ -z "$changed" ] && { echo "[pre-commit] OK (no relevant files staged)"; exit 0; }

if command -v sed >/dev/null 2>&1; then
  sed -i 's/\r$//' scripts/check-menu-toggle-events.js 2>/dev/null || true
fi

if command -v node >/dev/null 2>&1; then
  node scripts/check-menu-toggle-events.js
  rc=$?
else
  echo "[pre-commit] Node not found – skipping check."
  rc=0
fi

[ $rc -ne 0 ] && { echo "[pre-commit] ✖ aborting commit"; exit $rc; }
echo "[pre-commit] ✓ OK"
exit 0
