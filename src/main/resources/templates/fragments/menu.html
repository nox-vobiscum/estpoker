<!-- templates/fragments/menu.html -->
<!-- Reusable app menu (hamburger ‚Üí overlay) -->
<!-- Parameter:
     - showSeq  : show card sequence picker (room context, host-only hint)
     - showAuto : show auto-reveal toggle (room context, host-only hint)
     - showRoom : show room-specific actions/controls
-->
<div th:fragment="appMenu (showSeq, showAuto, showRoom)"
     th:with="showSeq=${showSeq}?:false,
              showAuto=${showAuto}?:false,
              showRoom=${showRoom}?:false">

  <!-- Hamburger trigger -->
  <button id="menuButton" class="menu-button"
          aria-expanded="false"
          aria-controls="appMenuOverlay"
          th:attr="aria-label=#{menu.open}"
          aria-label="Open menu">‚ò∞</button>

  <!-- Overlay root -->
  <div id="appMenuOverlay"
       class="menu-overlay hidden"
       role="dialog"
       aria-modal="true"
       aria-labelledby="menuTitle"
       th:attr="
         data-tip-theme-light=${#messages.msg('title.theme.light')},
         data-tip-theme-dark=${#messages.msg('title.theme.dark')},
         data-tip-theme-system=${#messages.msg('title.theme.system')},
         data-tip-lang-to=${#messages.msg('title.lang.to')}
       ">
    <div class="menu-backdrop" data-close></div>

    <div class="menu-panel no-horizontal-scroll">
      <!-- Sticky header -->
      <div class="menu-header">
        <h3 id="menuTitle" th:text="#{menu.title}">Settings</h3>
      </div>

      <!-- Scrollable body -->
      <div class="menu-section">

        <!-- Language switch (handled in menu.js) -->
        <button id="langRow" class="menu-item" type="button" th:attr="aria-label=#{title.lang}">
          <span class="mi-icon" aria-hidden="true">
            <span class="flag-split">
              <img class="flag flag-a" src="/flags/us.svg" alt="">
              <img class="flag flag-b" src="/flags/gb.svg" alt="">
            </span>
          </span>
          <span>
            <span th:text="#{menu.language}">Language</span>:
            <strong id="langCurrent">English</strong>
          </span>
        </button>

        <!-- Theme -->
        <div class="menu-group">
          <div class="group-title" th:text="#{menu.theme}">Theme</div>
          <div class="menu-choice">
            <button id="themeLight"  class="choice-btn" type="button" aria-pressed="false">
              <span class="mi-icon" aria-hidden="true">üåû</span>
              <span th:text="#{theme.light}">Light</span>
            </button>
            <button id="themeDark"   class="choice-btn" type="button" aria-pressed="false">
              <span class="mi-icon" aria-hidden="true">üåô</span>
              <span th:text="#{theme.dark}">Dark</span>
            </button>
            <button id="themeSystem" class="choice-btn" type="button" aria-pressed="false">
              <span class="mi-icon" aria-hidden="true">üñ•Ô∏è</span>
              <span th:text="#{theme.system}">System</span>
            </button>
          </div>
        </div>

        <!-- Card sequence (room context; read-only hint for non-host; events kommen √ºber room.js) -->
        <div class="menu-group" th:if="${showSeq}">
          <div class="group-title" th:text="#{menu.sequence}">Card sequence</div>

          <!-- Eigene ID, damit kein Konflikt mit In-Page #seqChoice -->
          <div id="menuSeqChoice" class="menu-choice vertical">
            <label class="radio-row">
              <input type="radio" name="menu-seq" value="fib-scrum" checked>
              <span th:text="#{sequence.fib.scrum}">Fibonacci (Scrum)</span>
            </label>
            <label class="radio-row">
              <input type="radio" name="menu-seq" value="fib-enh">
              <span th:text="#{sequence.fib.enh}">Fibonacci (Scrum enhanced)</span>
            </label>
            <label class="radio-row">
              <input type="radio" name="menu-seq" value="fib-math">
              <span th:text="#{sequence.fib.math}">Fibonacci (mathematical)</span>
            </label>
            <label class="radio-row">
              <input type="radio" name="menu-seq" value="pow2">
              <span th:text="#{sequence.pow2}">Powers of 2</span>
            </label>
            <label class="radio-row">
              <input type="radio" name="menu-seq" value="tshirt">
              <span th:text="#{sequence.tshirt}">T-Shirt sizes</span>
            </label>
          </div>

          <p id="menuSeqHint" class="hint" th:text="#{sequence.onlyHost}">
            Only the host can change the sequence
          </p>
        </div>

        <!-- Auto-reveal + Topic visibility (Overlay-IDs mit Prefix, damit keine Duplikate) -->
        <div class="menu-group" th:if="${showAuto}">
          <div class="group-title" th:text="#{menu.autoreveal}">Auto-reveal</div>

          <label id="menuAutoRevealRow" class="menu-item switch" for="menuAutoRevealToggle">
            <span class="mi-icon" aria-hidden="true">‚ö°</span>
            <span class="switch-text">
              <span th:text="#{menu.autoreveal}">Auto-reveal</span>:
              <strong id="menuArStatus">Off</strong>
            </span>
            <input id="menuAutoRevealToggle"
                   class="switch-control"
                   type="checkbox"
                   role="switch"
                   aria-checked="false">
          </label>
          <p id="menuArHint" class="hint" th:text="#{autoreveal.onlyHost}">
            Only the host can change this setting
          </p>

          <label id="menuTopicToggleRow" class="menu-item switch" for="menuTopicToggle">
            <span class="mi-icon" aria-hidden="true">üìù</span>
            <span class="switch-text">
              <strong th:text="#{label.topic}">Ticket/Story</strong>:
              <span id="menuTopicStatus">Off</span>
            </span>
            <input id="menuTopicToggle"
                   class="switch-control"
                   type="checkbox"
                   role="switch"
                   aria-checked="false">
          </label>
          <p id="menuTopicToggleHint" class="hint" style="display:none;"
             th:text="#{autoreveal.onlyHost}">
            Only the host can change this setting
          </p>
        </div>

        <!-- Participation (Overlay) -->
        <div class="menu-group" th:if="${showRoom}">
          <div class="group-title" th:text="#{menu.participation}">Participation</div>

          <label id="menuParticipationRow" class="menu-item switch" for="menuParticipationToggle">
            <span class="mi-icon" aria-hidden="true">üßë‚Äçü§ù‚Äçüßë</span>
            <span class="switch-text">
              <span th:text="#{menu.participation}">Participation</span>:
              <strong id="menuPartStatus">I'm estimating</strong>
            </span>
            <input id="menuParticipationToggle"
                   class="switch-control"
                   type="checkbox"
                   role="switch"
                   aria-checked="true">
          </label>
        </div>

        <!-- Room actions -->
        <div class="menu-group" th:if="${showRoom}">
          <div class="group-title" th:text="#{menu.room}">Room</div>

          <button id="closeRoomBtn" class="menu-item danger" type="button">
            <span class="mi-icon" aria-hidden="true">‚ùå</span>
            <span th:text="#{room.close}">Close room for everyone</span>
          </button>

          <p id="closeHint" class="hint" style="display:none;" th:text="#{room.close.hint}">
            Closes this room for all participants and returns to the start page.
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- menu behavior script (loaded by the fragment to avoid double-binding elsewhere) -->
  <script defer th:src="@{/js/menu.js}"></script>
</div>
