<!-- templates/fragments/menu.html -->
<th:block th:fragment="appMenu (showSeq, showAuto, showRoom)">

  <!-- Floating menu button (no tooltip ‚Äî self-explanatory) -->
  <button id="menuButton"
          class="menu-button"
          type="button"
          aria-haspopup="dialog"
          aria-expanded="false"
          data-i18n-attr="aria-label:ui.menu.open"
          aria-label="Open menu">‚ò∞</button>

  <!-- Overlay root (kept data-* for legacy/backward-compat only) -->
  <div id="appMenuOverlay"
       class="menu-overlay hidden"
       aria-hidden="true"
       data-tipThemeLight="Theme: Light"
       data-tipThemeDark="Theme: Dark"
       data-tipThemeSystem="Theme: System"
       data-tipLangTo="Switch language ‚Üí {0}">

    <div class="menu-backdrop" data-close></div>

    <div class="menu-panel"
         role="dialog"
         aria-modal="true"
         data-i18n-attr="aria-label:menu.settings"
         aria-label="Settings">

      <!-- Header / title -->
      <div class="menu-header">
        <h3 data-i18n="menu.settings">Settings</h3>
      </div>

      <!-- Language -->
      <div class="menu-section">
        <div class="section-title" data-i18n="menu.language">Language</div>

        <!-- One-line language row (clickable) -->
        <div id="langRow"
             class="menu-item"
             tabindex="0"
             role="button"
             data-i18n-attr="aria-label:menu.language"
             aria-label="Language"
             title="Switch language">
          <span class="mi-icon" aria-hidden="true">üåê</span>
          <div class="lang-inline">
            <span class="flag-split" aria-hidden="true">
              <img class="flag flag-a" src="/flags/us.svg" width="24" height="16" alt="">
              <img class="flag flag-b" src="/flags/gb.svg" width="24" height="16" alt="">
            </span>
            <span id="langCurrent">English</span>
          </div>
        </div>
      </div>

      <!-- Theme -->
      <div class="menu-section">
        <div class="section-title" data-i18n="menu.theme">Theme</div>
        <div class="menu-choice">
          <button id="themeLight"
                  type="button"
                  class="choice-btn"
                  aria-pressed="false"
                  data-i18n-attr="aria-label:theme.light"
                  title="Light theme">
            <span class="mi-icon" aria-hidden="true">‚òÄÔ∏è</span>
            <span data-i18n="theme.light">Light</span>
          </button>

          <button id="themeDark"
                  type="button"
                  class="choice-btn"
                  aria-pressed="false"
                  data-i18n-attr="aria-label:theme.dark"
                  title="Dark theme">
            <span class="mi-icon" aria-hidden="true">üåô</span>
            <span data-i18n="theme.dark">Dark</span>
          </button>

          <button id="themeSystem"
                  type="button"
                  class="choice-btn"
                  aria-pressed="false"
                  data-i18n-attr="aria-label:theme.system"
                  title="System theme">
            <span class="mi-icon" aria-hidden="true">üñ•Ô∏è</span>
            <span data-i18n="theme.system">System</span>
          </button>
        </div>
      </div>

      <!-- Card sequence (room only if showSeq==true) -->
      <div class="menu-section" th:if="${showSeq}">
        <div class="section-title" data-i18n="menu.sequence">Card sequence</div>

        <!-- NOTE: menu.js adds native title= previews to each label -->
        <fieldset id="menuSeqChoice" class="menu-choice vertical">
          <label class="radio-row">
            <input type="radio" name="menu-seq" value="fib.scrum" checked>
            <span data-i18n="sequence.fib.scrum">Fibonacci (Scrum basic)</span>
          </label>
          <label class="radio-row">
            <input type="radio" name="menu-seq" value="fib.enh">
            <span data-i18n="sequence.fib.enh">Fibonacci (Scrum enhanced)</span>
          </label>
          <label class="radio-row">
            <input type="radio" name="menu-seq" value="fib.math">
            <span data-i18n="sequence.fib.math">Fibonacci (mathematical)</span>
          </label>
          <label class="radio-row">
            <input type="radio" name="menu-seq" value="pow2">
            <span data-i18n="sequence.pow2">Powers of 2</span>
          </label>
          <label class="radio-row">
            <input type="radio" name="menu-seq" value="tshirt">
            <span data-i18n="sequence.tshirt">T-Shirt sizes</span>
          </label>
        </fieldset>
      </div>

      <!-- Room functions (show only if showAuto==true) -->
      <div class="menu-section" th:if="${showAuto}">
        <div class="section-title" data-i18n="menu.roomFunctions">Room functions</div>

        <div class="menu-item switch"
             role="group"
             id="rowAutoReveal"
             title="Automatically reveal cards once all estimators voted">
          <span class="mi-icon" aria-hidden="true">‚ö°</span>
          <div class="switch-text">
            <strong data-i18n="menu.autoreveal">Auto-reveal</strong>
            <span id="menuArStatus" data-i18n="toggle.off">Off</span>
          </div>
          <input id="menuAutoRevealToggle"
                 class="switch-control"
                 type="checkbox"
                 role="switch"
                 aria-checked="false"
                 data-i18n-attr="aria-label:menu.autoreveal"
                 aria-label="Auto-reveal">
        </div>

        <div class="menu-item switch"
             role="group"
             id="rowTopic"
             title="Show or hide the Ticket/Story row for the current round">
          <span class="mi-icon" aria-hidden="true">üßæ</span>
          <div class="switch-text">
            <strong data-i18n="label.topic">Ticket/Story</strong>
            <span id="menuTopicStatus" data-i18n="toggle.off">Off</span>
          </div>
          <input id="menuTopicToggle"
                 class="switch-control"
                 type="checkbox"
                 role="switch"
                 aria-checked="false"
                 data-i18n-attr="aria-label:label.topic"
                 aria-label="Ticket/Story">
        </div>
      </div>

      <!-- Personal functions (room-only; tied to showRoom) -->
      <div class="menu-section" th:if="${showRoom}">
        <div class="section-title" data-i18n="menu.personalFunctions">Personal functions</div>

        <div class="menu-item switch"
             role="group"
             id="rowParticipation"
             title="Toggle between estimator and observer mode for yourself">
          <span class="mi-icon" aria-hidden="true">üßë‚Äçüíª</span>
          <div class="switch-text">
            <strong data-i18n="menu.participation">Participation</strong>
            <span id="menuPartStatus" data-i18n="participation.imIn">I'm estimating</span>
          </div>
          <input id="menuParticipationToggle"
                 class="switch-control"
                 type="checkbox"
                 role="switch"
                 aria-checked="true"
                 checked
                 data-i18n-attr="aria-label:menu.participation"
                 aria-label="Participation">
        </div>
      </div>

      <!-- Close room (room-only; ‚ùå icon restored) -->
      <div class="menu-section" th:if="${showRoom}">
        <button id="closeRoomBtn"
                type="button"
                class="menu-item danger"
                data-i18n="room.close"
                data-i18n-attr="aria-label:room.close"
                title="Closes this room for all participants and returns to the start page.">
          <span class="mi-icon" aria-hidden="true">‚ùå</span>
          <span class="truncate-1">Close room for everyone</span>
        </button>
      </div>

    </div>
  </div>

  <!-- Load JS (cache-bust; keep in fragment so it‚Äôs present where menu is used) -->
  <script defer src="/js/menu.js?v=27"></script>
</th:block>
