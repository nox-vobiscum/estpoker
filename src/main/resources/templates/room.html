<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="de">
<head>
    <meta charset="UTF-8">
    <title>Estimation Poker</title>
    <link rel="stylesheet" th:href="@{/styles.css}">
    <style>
        .selected {
            background-color: #4CAF50;
            color: white;
            font-weight: bold;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>ğŸƒ Estimation Poker - Raum: <span th:text="${roomCode}"></span></h1>

    <p>ğŸ‘¤ Du bist: <strong th:text="${participantName}"></strong></p>
    <p th:if="${isHost}">â­ Du bist der Host</p>
    <p th:if="${!isHost}">Host: <strong th:text="${hostName}"></strong></p>

    <!-- Kartenabgabe -->
    <div th:if="${!votesRevealed}">
        <form method="post" th:action="@{/room}" id="voteForm">
            <input type="hidden" name="roomCode" th:value="${roomCode}"/>
            <input type="hidden" name="participantName" th:value="${participantName}"/>
            <input type="hidden" name="card" id="cardInput"/>

            <p><strong>Karte auswÃ¤hlen:</strong></p>
            <div class="card-grid">
    <button type="button"
            th:each="cardValue : ${cards}"
            th:text="${cardValue}"
            th:classappend="${selectedCard != null and cardValue == selectedCard} ? ' selected' : ''"
            th:data-card="${cardValue}" 
            th:onclick="|submitVote(this.getAttribute('data-card'))|">
    </button>
</div>

            </div>
        </form>

        <!-- Karten aufdecken (nur fÃ¼r Host) -->
        <form method="post" th:action="@{/reveal}" th:if="${isHost}">
            <input type="hidden" name="roomCode" th:value="${roomCode}"/>
            <input type="hidden" name="participantName" th:value="${participantName}"/>
            <button type="submit">ğŸŸ¡ Karten aufdecken</button>
        </form>
    </div>

    <!-- Ergebnisse -->
    <div th:if="${votesRevealed}">
        <h2>Ergebnisse</h2>
        <ul>
            <li th:each="p : ${votes}">
                <span th:text="${p.name}"></span>:
                <strong th:text="${p.vote != null ? p.vote : 'â€”'}"></strong>
            </li>
        </ul>

        <p><strong>âŒ€ Durchschnitt (nur Zahlen):</strong>
            <span th:text="${averageVote != null ? averageVote : 'â€“'}"></span>
        </p>

        <form method="post" th:action="@{/reset}" th:if="${isHost}">
            <input type="hidden" name="roomCode" th:value="${roomCode}"/>
            <input type="hidden" name="participantName" th:value="${participantName}"/>
            <button type="submit">ğŸ”„ Neue Runde starten</button>
        </form>
    </div>

    <!-- JavaScript -->
    <script>
    function submitVote(cardValue) {
        console.log("Kartenwert: " + cardValue);  // Loggt den Wert der Karte in der Konsole
        document.getElementById('cardInput').value = cardValue.trim();
        document.getElementById('voteForm').submit();
    }
</script>
</div>
</body>
</html>
