<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="de">
<head>
    <meta charset="UTF-8">
    <title>Estimation Poker</title>
    <link rel="stylesheet" th:href="@{/styles.css}">
</head>
<body>
<div class="container">
    <h1>🃏 Estimation Poker – Raum: <span th:text="${roomCode}"></span></h1>

    <p>👤 Du bist: <strong th:text="${participantName}"></strong></p>

    <p th:if="${isHost}">⭐ Du bist der Host</p>
    <p th:if="${!isHost}">Host: <strong th:text="${hostName}"></strong></p>

    <!-- Kartenabgabe (nur wenn noch nicht aufgedeckt) -->
    <div th:if="${!votesRevealed}">
        <form method="post" th:action="@{/room}" id="voteForm">
            <input type="hidden" name="roomCode" th:value="${roomCode}"/>
            <input type="hidden" name="participantName" th:value="${participantName}"/>
            <input type="hidden" name="card" id="cardInput"/>

            <p><strong>Karte auswählen:</strong></p>
            <div class="card-grid">
    <button type="button"
            th:each="card : ${cards}"
            th:text="${card}"
            th:onclick="'submitVote(\'' + card + '\')'"
            th:classappend="${card == #lists.find(votes, v -> v.name == participantName)?.vote} ? 'selected' : ''">
    </button>
</div>
        </form>

        <!-- Karten aufdecken (nur für Host) -->
        <form method="post" th:action="@{/reveal}" th:if="${isHost}">
            <input type="hidden" name="roomCode" th:value="${roomCode}"/>
            <input type="hidden" name="participantName" th:value="${participantName}"/>
            <button type="submit">🟡 Karten aufdecken</button>
        </form>
    </div>

    <!-- Ergebnisse -->
<div th:if="${votesRevealed}">
    <h2>Ergebnisse</h2>
    <ul>
        <li th:each="p : ${votes}">
            <span th:text="${p.name}"></span>:
            <strong th:text="${p.vote != null ? p.vote : '—'}"></strong>
        </li>
    </ul>

    <p><strong>⌀ Durchschnitt (nur Zahlen):</strong>
        <span th:text="${averageVote != null ? averageVote : '–'}"></span>
    </p>

    <!-- 🧹 Reset-Button für den Host -->
    <form method="post" th:action="@{/reset}" th:if="${isHost}">
        <input type="hidden" name="roomCode" th:value="${roomCode}"/>
        <input type="hidden" name="participantName" th:value="${participantName}"/>
        <button type="submit">🔄 Neue Runde starten</button>
    </form>
</div>


<!-- Voting Script -->
<script>
    function submitVote(cardValue) {
        document.getElementById('cardInput').value = cardValue.trim();
        document.getElementById('voteForm').submit();
    }
</script>
</body>
</html>
