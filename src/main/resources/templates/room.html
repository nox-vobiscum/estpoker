<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:lang="${#locale}" lang="en">
<head th:replace="~{fragments/head :: head}"></head>
<body>

  <!-- Globales App-Menü (vollständiges Menü im Room) -->
  <div th:replace="~{fragments/menu :: appMenu(showSeq=${true}, showAuto=${true}, showRoom=${true})}"></div>

  <div class="container">
    <h1 class="app-title">
      <img src="/favicon.svg" alt="" width="24" height="24" class="logo">
      <span th:text="#{ui.heading}">RBS' Estimation Poker</span>
    </h1>

    <!-- Du + Raum-Info -->
    <dl class="main-info">
      <dt><span class="mi-icon" aria-hidden="true">👤</span><span class="mi-label" th:text="#{label.you}">You are:</span></dt>
      <dd><strong id="youName" th:text="${participantName}">Guest</strong></dd>

      <dt><span class="mi-icon" aria-hidden="true">🆔</span><span class="mi-label" th:text="#{label.room}">Room:</span></dt>
      <dd>
        <div class="room-with-actions">
          <strong id="roomCodeVal" th:text="${roomCode}">demo</strong>
          <button id="copyRoomLink"
                  class="icon-button"
                  type="button"
                  th:attr="aria-label=#{invite.copyLink},data-tooltip=#{invite.copyLink}"
                  aria-live="polite">🔗
          </button>
        </div>
      </dd>
    </dl>

    <h2 th:text="#{label.participants}">Participants</h2>
    <ul id="liveParticipantList"></ul>

    <!-- Topic (Ticket/Story) — kompakte Anzeige + Editor (nur Host) -->
    <div id="topicRow" class="topic-row" style="display:none;">
      <span class="topic-label" aria-hidden="true">📝</span>
      <span id="topicDisplay" class="topic-text">—</span>
      <div class="topic-actions">
        <button id="topicEditBtn" class="row-action" type="button" data-tooltip="Edit" aria-label="Edit">
          <span class="ra-icon">✏️</span><span class="ra-label">Edit</span>
        </button>
        <button id="topicClearBtn" class="row-action kick" type="button"
                th:attr="data-tooltip=#{button.clearTopic},aria-label=#{button.clearTopic}">
          <span class="ra-icon">🧹</span><span class="ra-label" th:text="#{button.clearTopic}">Clear</span>
        </button>
      </div>
    </div>

    <div id="topicEdit" class="topic-edit" style="display:none;">
      <input id="topicInput"
             class="topic-input"
             type="text"
             th:attr="placeholder=#{topic.placeholder}"
             placeholder="Paste JIRA link or type key (e.g., RBSEP-123)…">
      <div class="topic-actions">
        <button id="topicSaveBtn" class="row-action host" type="button"
                th:attr="data-tooltip=#{button.saveTopic},aria-label=#{button.saveTopic}">
          <span class="ra-icon">✅</span><span class="ra-label" th:text="#{button.saveTopic}">Save</span>
        </button>
        <button id="topicCancelBtn" class="row-action" type="button" data-tooltip="Cancel" aria-label="Cancel">
          <span class="ra-icon">❌</span><span class="ra-label">Cancel</span>
        </button>
      </div>
    </div>

    <!-- Screenreader-only Label für den Kartenbereich -->
    <span id="cardsLabel" class="sr-only" th:text="#{label.selectCard}">Choose a card</span>

    <div class="pre-vote" aria-labelledby="cardsLabel">
      <div id="cardsArea"></div>
      <button type="button" id="revealButton" class="button" style="display:none;"
              th:text="#{button.reveal}" onclick="revealCards()"></button>
    </div>

    <div class="post-vote" style="display:none;">
      <p id="resultRow"
         class="average-label consensus-row"
         role="status"
         aria-live="polite"
         aria-atomic="true">
        <span id="resultLabel" class="label" th:text="#{label.average}">Avg:</span>
        <span id="averageVote" class="value">–</span>

        <span class="sep" aria-hidden="true"> • </span>

        <span id="medianWrap" class="stat" hidden>
          <span id="medianLabel" class="label" th:text="#{label.median}">Median:</span>
          <span id="medianVote" class="value">–</span>
        </span>

        <span class="sep" aria-hidden="true" id="rangeSep" hidden> • </span>

        <span id="rangeWrap" class="stat" hidden>
          <span id="rangeLabel" class="label" th:text="#{label.range}">Range:</span>
          <span id="rangeVote" class="value">–</span>
        </span>
      </p>

      <button type="button" id="resetButton" class="button" style="display:none;"
              th:text="#{button.reset}" onclick="resetRoom()"></button>
    </div>
  </div>

  <!-- Gemeinsame Skripte (Tooltip etc.) -->
  <th:block th:replace="~{fragments/scripts :: scripts}"></th:block>

  <!-- Room-Logik (extern) – Daten via data-* am Script, Cache-Bust per v=6 -->
  <script defer th:src="@{/room.js?v=8}"
        th:attr="data-participant=${participantName},data-room=${roomCode}"></script>

  <div th:replace="~{fragments/footer :: appFooter}"></div>
</body>
</html>
