/* ===========================
   THEME & TOKENS
   =========================== */
html {
  --bg: #1e1e1e;
  --text: #d4d4d4;
  --text-strong: #ffffff;
  --text-dim: #bbbbbb;

  --panel: #2d2d30;
  --panel-2: #3c3c3c;
  --border: #3c3c3c;

  --accent: #007acc;
  --accent-strong: #005a9e;
  --ok: #4CAF50;
  --ok-border: #81C784;
  --warn: #FFD54F;
  --danger: #ef4444;

  --shadow: 0 6px 16px rgba(0,0,0,0.25);
  --radius: 12px;
  --radius-sm: 8px;

  --h-input: 44px;
  --h-button: 44px;

  --gap: 12px;
  --gap-sm: 8px;

  /* Cards */
  --card-size-desktop: 72px;
  --card-size-mobile: 56px;
  --card-aspect: 4 / 3;

  /* Spacing */
  --pre-vote-margin-desktop: 2rem;
  --pre-vote-margin-mobile: 1.5rem;

  /* Participant list columns */
  --icon-col-width: 1.5rem;
  --name-text-col: 0px;

  /* Special chips */
  --special-chip-bg: #374151;
  --special-chip-border: #6b7280;
  --special-chip-fg: #f3f4f6;
}
@media (prefers-color-scheme: light) {
  html:not([data-theme]) {
    --bg: #f7f7f8;
    --text: #1b1b1d;
    --text-strong: #000;
    --text-dim: #4b4b4f;

    --panel: #ffffff;
    --panel-2: #f0f2f5;
    --border: #d9d9de;

    --accent: #0066cc;
    --accent-strong: #004c99;

    --shadow: 0 8px 24px rgba(0,0,0,0.07);

    --special-chip-bg: #f1f3f5;
    --special-chip-border: #c9ccd1;
    --special-chip-fg: #1b1b1d;
  }
}
html[data-theme="light"] {
  --bg: #f7f7f8;
  --text: #1b1b1d;
  --text-strong: #000;
  --text-dim: #4b4b4f;

  --panel: #ffffff;
  --panel-2: #f0f2f5;
  --border: #d9d9de;

  --accent: #0066cc;
  --accent-strong: #004c99;

  --shadow: 0 8px 24px rgba(0,0,0,0.07);

  --special-chip-bg: #f1f3f5;
  --special-chip-border: #c9ccd1;
  --special-chip-fg: #1b1b1d;
}

/* ===========================
   BASE LAYOUT
   =========================== */
* { box-sizing: border-box; }
body {
  background-color: var(--bg);
  color: var(--text);
  font-family: Consolas, ui-monospace, SFMono-Regular, Menlo, Monaco, "Liberation Mono", "Courier New", monospace;
  padding: 2rem;
  margin: 0;
}
.container { max-width: 800px; margin: 0 auto; padding: 1rem; position: relative; }
h1, h2 { color: var(--text-strong); margin-bottom: 2rem; font-size: 1.1rem; }
strong { color: var(--text-strong); }

/* ===========================
   FLOATING TOGGLES
   =========================== */
.theme-toggle,
.lang-toggle {
  position: absolute;
  top: 8px;
  width: 36px;
  height: 36px;
  border-radius: 9999px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  background: var(--panel-2);
  color: var(--text);
  border: 1px solid var(--border);
  cursor: pointer;
  box-shadow: var(--shadow);
  user-select: none;
  transition: transform .12s ease, background .18s ease, box-shadow .18s ease;
}
.theme-toggle { right: 8px; }
.lang-toggle  { right: 52px; }
.theme-toggle:hover,
.lang-toggle:hover { background: #414449; transform: translateY(-1px); }
.theme-toggle:focus-visible,
.lang-toggle:focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; }

/* Split-flag (two images clipped diagonally) */
.flag-split { position: relative; width: 22px; height: 22px; display: block; }
.flag {
  position: absolute; inset: 0;
  width: 100%; height: 100%;
  object-fit: cover;
}
.flag-a { clip-path: polygon(0% 0%, 100% 0%, 0% 100%); }
.flag-b { clip-path: polygon(100% 100%, 100% 0%, 0% 100%); }

.visually-hidden{
  position:absolute !important; height:1px; width:1px; overflow:hidden; clip:rect(1px,1px,1px,1px);
  white-space:nowrap; border:0; padding:0; margin:-1px;
}

/* ===========================
   FORM / LANDING
   =========================== */
.landing-container { display:flex; flex-direction:column; align-items:center; min-height:90vh; padding:2rem; text-align:center; margin-top:10vh; }
.join-form { display:flex; flex-direction:column; align-items:center; gap:1rem; width:100%; }
.form-row { display:flex; flex-direction:column; gap:1rem; width:100%; max-width:400px; }
.form-field { width:100%; }
input[type="text"]{
  height:var(--h-input); padding:0 1rem; font-size:1rem; border:1px solid #555; border-radius:var(--radius-sm); background:var(--panel-2); color:var(--text);
  width:100%; outline:none; transition:box-shadow 180ms ease, border-color 180ms ease, background 180ms ease;
}
input[type="text"]:focus{ border-color:var(--accent); box-shadow:0 0 0 3px color-mix(in srgb, var(--accent) 25%, transparent); background:color-mix(in srgb, var(--panel-2) 85%, var(--accent) 15%); }
.checkbox-row{ display:flex; align-items:center; gap:.5rem; width:100%; max-width:400px; }
.hint{ width:100%; max-width:400px; color:var(--text-dim); font-size:.9rem; margin:-4px 0 8px; }
.form-actions{ width:100%; max-width:400px; }
.error{ background:#7f1d1d; border:1px solid #b91c1c; color:#fee2e2; padding:12px; border-radius:10px; width:100%; max-width:400px; margin:0 auto 1rem; }

/* ===========================
   GENERIC BUTTONS
   =========================== */
.button, button[type="submit"]{
  margin-top:1.5rem; height:var(--h-button); padding:0 1.2rem; background:var(--accent); color:#fff; border:none; border-radius:var(--radius);
  cursor:pointer; font-size:1rem; font-family:inherit; transition:transform 120ms ease, filter 180ms ease, box-shadow 180ms ease, background 180ms ease; box-shadow:var(--shadow);
}
.button:hover, button[type="submit"]:hover{ background:var(--accent-strong); filter:brightness(1.04); }
.button:active, button[type="submit"]:active{ transform: translateY(1px) scale(0.985); }
.button:disabled, button[type="submit"]:disabled{ opacity:.6; cursor:not-allowed; }
@keyframes shake{ 0%,100%{transform:translateX(0)} 20%,60%{transform:translateX(-6px)} 40%,80%{transform:translateX(6px)} }
button.shake{ animation:shake .4s; }

/* ===========================
   CARD GRID & CARDS
   =========================== */
.card-grid{
  --card-size: var(--card-size-desktop);
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(var(--card-size), var(--card-size)));
  justify-content:center;
  gap:8px;
  margin:1rem 0;
}
.card-grid button{
  width:var(--card-size);
  aspect-ratio: var(--card-aspect);
  padding:.55rem;
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:10px;
  cursor:pointer;
  transition: transform .15s ease, box-shadow .2s ease, background .2s ease, border-color .2s ease;
  font-size: clamp(1.1rem, 2.6vw, 1.45rem);
  line-height:1;
  text-align:center;
  color:var(--text);
  position:relative;
  margin:0;
}
.card-grid button:hover{ background:#36383c; transform:translateY(-1px); box-shadow:0 0 10px color-mix(in srgb, var(--accent) 35%, transparent); border-color:#4a4a4a; }
button.selected{
  background:#163a52 !important; color:#fff !important; font-weight:bold;
  border:2px solid color-mix(in srgb, var(--accent) 60%, transparent);
  box-shadow:0 0 0 4px color-mix(in srgb, var(--accent) 22%, transparent), 0 0 12px color-mix(in srgb, var(--accent) 35%, transparent);
  transform:scale(1.03);
}
.card-grid .checkmark{
  position:absolute; top:6px; right:8px; font-size:.95rem; color:var(--ok); background:var(--bg); border-radius:999px; padding:0 6px; line-height:1.05; display:none;
  box-shadow:0 0 4px var(--ok); opacity:0; transform:scale(.9); transition:opacity 180ms ease, transform 180ms ease;
}
button.selected .checkmark{ display:block; opacity:1; transform:scale(1); }

/* ===========================
   PARTICIPANT LIST
   =========================== */
ul{ list-style:none; padding:0; margin:0; }
li{ margin-bottom:.4rem; line-height:1.5; font-size:1rem; }

#liveParticipantList li[data-hasvote]::after{ content:""; }

#liveParticipantList .participant-row{
  display:grid;
  grid-template-columns: var(--icon-col-width) max(18ch, var(--name-text-col)) auto;
  align-items:center; column-gap:.4rem; margin-bottom:.4rem; padding:6px 8px; border-bottom:1px solid var(--border); border-radius:6px;
}
#liveParticipantList .participant-row.is-host{ background: color-mix(in srgb, var(--accent) 8%, transparent); outline:1px solid color-mix(in srgb, var(--accent) 22%, transparent); }

.participant-icon{ width:var(--icon-col-width); display:inline-flex; justify-content:center; align-items:center; line-height:1; }
.participant-icon.host{ font-size:1.1rem; }
.participant-icon.inactive{ opacity:.75; }

.name{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis; min-width:0; color:var(--text); }

.row-right{ display:inline-flex; align-items:center; justify-content:flex-start; margin:0; padding:0; gap:6px; }

#liveParticipantList li.disconnected{ color:#888; font-style:italic; text-decoration:none; }

/* Status icons */
.status-icon{ font-size:1rem; line-height:1; display:inline-flex; align-items:center; }
.status-icon.done{ color:var(--ok); filter: drop-shadow(0 0 2px rgba(76,175,80,.6)); }
.status-icon.pending{ color:var(--warn); opacity:.95; }

/* ===========================
   VOTE CHIPS
   =========================== */
.vote-chip{
  display:inline-block; padding:.18rem .55rem; border-radius:8px; background:var(--ok); color:#fff; font-weight:bold; border:2px solid var(--ok-border);
  box-shadow:0 0 6px var(--ok); font-size:.95rem; line-height:1.2; min-width:2ch; text-align:center; opacity:0; transform:translateY(6px); animation:chipIn 220ms ease forwards;
}
.vote-chip.special{
  background: var(--special-chip-bg);
  border-color: var(--special-chip-border);
  color: var(--special-chip-fg);
  box-shadow: none;
  font-size: 1.05rem;
}
@keyframes chipIn{ to{ opacity:1; transform:translateY(0); } }

/* ===========================
   HEADER INFO
   =========================== */
.main-info{
  display:grid; grid-template-columns:auto 1fr; align-items:baseline; column-gap:.75rem; row-gap:.35rem; margin-bottom:1.5rem;
}
.main-info dt, .main-info dd{ margin:0; }
.main-info dt{ display:inline-flex; gap:.45rem; color:var(--text-dim); }
.main-info dd{ color:var(--text-strong); }
.mi-icon{ min-width:1.15rem; text-align:center; }
.mi-label{ min-width:5.5rem; }

/* ===========================
   VOTE BLOCKS & AVERAGE
   =========================== */
.pre-vote{ margin-top: var(--pre-vote-margin-desktop); }
.average-label{ font-size: 0.9rem; color: var(--text-dim); margin-top:1rem; }
.average-label #averageVote{ font-size: 1em; font-weight: normal; opacity:0; animation: avgIn 240ms ease forwards; }
@keyframes avgIn{ to{ opacity:1; } }

/* ===========================
   TOASTS
   =========================== */
.toast{
  position:fixed; top:20px; right:20px; background: color-mix(in srgb, #333 95%, transparent); color:#fff; padding:12px 20px; border-radius:10px; z-index:9999; font-size:14px;
  box-shadow:var(--shadow); transform:translateY(-10px); opacity:0; animation:fadein 220ms ease forwards, fadeout 400ms ease 2400ms forwards;
}
@keyframes fadein{ to{ opacity:.95; transform:translateY(0);} }
@keyframes fadeout{ to{ opacity:0; } }

/* ===========================
   UTILITIES & RESPONSIVE
   =========================== */
.hidden{ display:none !important; }

@media (max-width: 600px) {
  body{ padding:1rem; }
  .container{ padding:.5rem; }

  .card-grid{ --card-size: var(--card-size-mobile); gap:6px; }
  .card-grid button{ padding:.45rem; font-size: clamp(1.0rem, 5.5vw, 1.2rem); }

  .button{ width:100%; font-size:1.05rem; }

  h1, h2{ font-size:1.25rem; }

  .toast{ font-size:.95rem; }

  .pre-vote{ margin-top: var(--pre-vote-margin-mobile); }
}
